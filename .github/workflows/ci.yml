name: cli
on:
  workflow_dispatch:
  schedule:
    # Runs at 01:00, 07:00, 13:00, and 19:00 UTC
    - cron: "0 1/6 * * *"

jobs:
  cli:
    runs-on: ubuntu-latest
    timeout-minutes: 355 # Set close to the 6-hour interval (360 minutes)

    steps:
    - name: Install CLI
      run: |
        curl -fsSL https://cli.nexus.xyz/ | sh
        echo "$HOME/.nexus/bin" >> $GITHUB_PATH

    - name: Start and Run for ~5h50m
      run: |
        set -e
        NODE_ID=37243001

        # 348 minutes = 5 hours and 48 minutes (348 * 60 = 20880 seconds)
        # This gives a 12-minute buffer before the next job starts at the 6-hour mark.
        SLEEP_SECONDS=20880

        echo "ğŸš€ Starting (Node ID: $NODE_ID) at $(date -u)"
        nexus-cli start --node-id "$NODE_ID" --max-threads 3 --headless &
        NEXUS_PID=$!

        echo "ğŸ›ï¸ Will run for 5 hours and 48 minutes."
        sleep "$SLEEP_SECONDS"

        echo "ğŸ›‘ Stopping at $(date -u)"
        kill "$NEXUS_PID" || true
